<!DOCTYPE html>

<html>
    <head>
        <title> Arrows Express - Search </title>
        <link rel="icon" type="image/png" href="../images/DLSU_Logo.png">
        <link rel="stylesheet" href="../css/FormStyle.css">  <!-- Kailangan to if may separate CSS file -->
        <link rel="stylesheet" href="../css/ReservationStyle.css">
		<link rel="stylesheet" href="../css/SearchStyle.css">
    </head>

    <body>
        
        <div class = "banner"> 

            <div class="navbar">
                <a onclick="history.back(); clear_User();"><img src="../images/Leftarrow.png" class = "back_img"></a>
                <a href="/"> <img src= "../images/DLSU_Logo.png" class = "website_logo"> </a> 
            </div>
            
            <div class="content">

                <h1 style="position: relative; color: white; left: 60px; top: 40px; margin-bottom: 30px;">Search</h1>

				<div style="background: rgba(100,100,100, 0.2); border-radius: 20px; width: 88%; height: 6%; margin-left: 50px; margin-top: 55px;">
					<style>
						input[name="search"]{
							width: 95%;
							background: transparent;
							border-style: none none solid none;
							border-bottom-color: gray;
							font-size: 25px;
							position: relative;
							top: 50%;
							transform: translateY(-50%);
							margin-left: 15px;
							color: white;
							float: left;
						}
						
						#searchIcon{
							position: relative;
							top: 23px;
							left: 15px;
							float: right;
							transform: translate(110%,-50%);
							width: 40px;
							height: 40px;
						}
						
						#searchIcon:hover{
							cursor: pointer;
						}
					</style>
					<label for="search"></label>
					<input type="text" placeholder="View a profile..." name="search" id="search" onkeyup="send_data(this);">
                    <img src="../images/SearchIcon.png" id="searchIcon" >

					<script>

						window.onload = function() {
							send_data(document.getElementById("search"));
						}

						function send_data(e) {
							const result_container = document.getElementsByClassName('results_container')[0];
							const user_care_template = document.getElementsByTagName('template')[0].content;
							
							fetch('user_search', {
								method: 'POST',
								headers: { 'Content-Type': 'application/json' },
								body: JSON.stringify({ payload: e.value })
							}).then(res => res.json()).then(data => {
								const payload = data.payload;
								
								result_container.innerHTML = "";

								payload.forEach(item => {
									const copy_user_card_template = document.importNode(user_care_template, true);
									const name_element = copy_user_card_template.querySelector('.name');
									const designation_element = copy_user_card_template.querySelector('.designation');
									const html_attribute = copy_user_card_template.querySelector(".htmlLink");
									const img_element = copy_user_card_template.querySelector("img");

									name_element.textContent = item.firstName + " " + item.lastName;
									designation_element.textContent = item.passengerType;
									html_attribute.setAttribute("href", "/SearchProfile?id_number=" + item.id_number);

									if (item.profilePicture == null)
										img_element.setAttribute("src", "images/Default.png");
									else
										img_element.setAttribute("src", item.profilePicture);
									
									result_container.appendChild(copy_user_card_template);
								});
							}) .catch(error => {
								console.error('Error:', error);
							});
						}

					</script>

				</div>

				<div class="container">
					
					<div class="results_container">
					</div>

				</div>
                
				<template> 
					<div class="card">
						<a class="htmlLink" href="#" style="text-decoration: none;">
							<img src="../images/DLSU_Logo.png">
							<p class="name"></p>
							<p class="designation"></p>
						</a> 
					</div>
				</template>

            </div>

        </div>
    </body>

</html>
